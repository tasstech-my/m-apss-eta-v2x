import React, { useMemo, useState } from 'react';
import type { FlightJourney, FlightMapPassenger } from '../types';


// Data Structures
interface Airport {
  iata: string;
  name: string;
  coords: { x: number; y: number };
}

// Mock Data
const airports: Airport[] = [
  { iata: 'CGK', name: 'Jakarta', coords: { x: 67, y: 55 } },
  { iata: 'SIN', name: 'Singapore', coords: { x: 65, y: 52 } },
  { iata: 'KUL', name: 'Kuala Lumpur', coords: { x: 64, y: 51 } },
  { iata: 'BKK', name: 'Bangkok', coords: { x: 64, y: 45 } },
  { iata: 'HKG', name: 'Hong Kong', coords: { x: 70, y: 40 } },
  { iata: 'NRT', name: 'Tokyo', coords: { x: 78, y: 35 } },
  { iata: 'SYD', name: 'Sydney', coords: { x: 82, y: 75 } },
  { iata: 'DXB', name: 'Dubai', coords: { x: 48, y: 40 } },
  { iata: 'IST', name: 'Istanbul', coords: { x: 40, y: 33 } },
  { iata: 'AMS', name: 'Amsterdam', coords: { x: 30, y: 28 } },
  { iata: 'LHR', name: 'London', coords: { x: 28, y: 29 } },
  { iata: 'JFK', name: 'New York', coords: { x: 12, y: 33 } },
  { iata: 'LAX', name: 'Los Angeles', coords: { x: 5, y: 36 } },
  { iata: 'PER', name: 'Perth', coords: { x: 70, y: 73 } },
];

const mockNationalities = ['IDN', 'USA', 'SGP', 'MYS', 'AUS', 'CHN', 'JPN', 'GBR', 'DEU', 'FRA', 'IND', 'KOR'];

const generatePassengers = (count: number): FlightMapPassenger[] => {
  const passengers: FlightMapPassenger[] = [];
  for (let i = 0; i < count; i++) {
    const rand = Math.random();
    passengers.push({
      gender: rand < 0.48 ? 'Male' : rand < 0.96 ? 'Female' : 'Other',
      nationality: mockNationalities[Math.floor(Math.random() * mockNationalities.length)],
    });
  }
  return passengers;
};


const today = new Date();
const formatDate = (date: Date) => date.toISOString().split('T')[0];
export const todayStr = formatDate(today);
const tomorrow = new Date(today);
tomorrow.setDate(today.getDate() + 1);
const tomorrowStr = formatDate(tomorrow);
const yesterday = new Date(today);
yesterday.setDate(today.getDate() - 1);
const yesterdayStr = formatDate(yesterday);


export const mockFlights: FlightJourney[] = [
  { id: 'FL001', flightNumber: 'GA886', origin: 'CGK', destination: 'AMS', date: todayStr, status: 'On Time', departureTime: '21:45', arrivalTime: '07:15', alertCount: 0, passengers: generatePassengers(320) },
  { id: 'FL002', flightNumber: 'SQ957', origin: 'CGK', destination: 'SIN', date: todayStr, status: 'Alert', departureTime: '14:10', arrivalTime: '15:55', alertCount: 2, passengers: generatePassengers(180) },
  { id: 'FL003', flightNumber: 'QR955', origin: 'CGK', destination: 'DXB', date: todayStr, status: 'On Time', departureTime: '18:30', arrivalTime: '23:45', alertCount: 0, passengers: generatePassengers(380) },
  { id: 'FL004', flightNumber: 'EK357', origin: 'DXB', destination: 'CGK', date: todayStr, status: 'On Time', departureTime: '04:15', arrivalTime: '15:25', alertCount: 0, passengers: generatePassengers(410) },
  { id: 'FL005', flightNumber: 'JL726', origin: 'CGK', destination: 'NRT', date: todayStr, status: 'Alert', departureTime: '06:55', arrivalTime: '16:20', alertCount: 1, passengers: generatePassengers(290) },
  { id: 'FL006', flightNumber: 'QF42', origin: 'CGK', destination: 'SYD', date: todayStr, status: 'On Time', departureTime: '19:00', arrivalTime: '05:30', alertCount: 0, passengers: generatePassengers(310) },
  { id: 'FL007', flightNumber: 'BA39', origin: 'LHR', destination: 'HKG', date: yesterdayStr, status: 'On Time', departureTime: '18:40', arrivalTime: '13:50', alertCount: 0, passengers: generatePassengers(340) },
  { id: 'FL008', flightNumber: 'AA125', origin: 'JFK', destination: 'LHR', date: yesterdayStr, status: 'Alert', departureTime: '20:10', arrivalTime: '08:15', alertCount: 3, passengers: generatePassengers(280) },
  { id: 'FL009', flightNumber: 'KE628', origin: 'CGK', destination: 'PER', date: tomorrowStr, status: 'On Time', departureTime: '23:55', arrivalTime: '05:15', alertCount: 0, passengers: generatePassengers(260) },
  { id: 'FL010', flightNumber: 'SQ958', origin: 'SIN', destination: 'CGK', date: todayStr, status: 'On Time', departureTime: '07:50', arrivalTime: '09:35', alertCount: 0, passengers: generatePassengers(195) },
  { id: 'FL011', flightNumber: 'GA887', origin: 'AMS', destination: 'CGK', date: todayStr, status: 'On Time', departureTime: '12:00', arrivalTime: '06:30', alertCount: 0, passengers: generatePassengers(330) },
];

// Simplified world map path data
const worldMapPath = "M82.8,75.4l0.6-2.9l-0.3-2.6l-1.9-3.4l-2.1-1.3l-1.3-1.6l-1.9-0.5l-1-1.6l-2.4-0.8l-1.3-1.3l-1.5-2.7l-2.1-1.5l-1.6-2.2l-2.9-1.5l-1-2.4l-2.7-1.3l-0.8-2.6l-1.9-1.5l-0.6-2.2l-1.6-1.2l-0.6-1.9l-1.5-1l-0.6-2.1l-1.9-1l-1.2-2.2l-2.2-1.2l-1-2.4l-2.6-1l-0.8-2.2l-2.1-1l-1.2-1.9l-2.4-1l-1.2-2.1l-2.1-0.8l-1.2-2.1l-2.4-0.8l-1.3-2.1l-2.1-0.8l-1.3-2.2l-2.1-0.8l-1.3-2.4l-2.1-0.8l-1.3-2.6l-1.9-0.8l-1.5-2.7l-1.9-0.6l-1.5-2.9l-1.9-0.5l-1.5-3.2l-1.9-0.3l-1.5-3.4l-1.8-0.2l-1.6-3.4l-1.8-0.2l-1.6-3.7l-1.8-0.2l-1.6-3.9l-1.8-0.2l-1.6-4.2l-1.8-0.2l-1.5-4.3l-1.8-0.2l-1.5-4.6l-1.8-0.1l-1.5-4.8l-1.8-0.1l-1.5-5l-1.8-0.1l-1.5-5.2l-1.8-0.1l-1.5-5.4l-1.8-0.1l-1.5-5.6l-1.8,0l-1.5-5.8l-1.8,0l-1.5-6l-1.8,0l-1.5-6.2l-1.8,0l-1.5-6.4l-1.8,0l-1.5-6.6l-1.8,0l-1.5-6.8l-1.8,0l-1.5-7l-1.8,0l-1.5-7.2l-1.8,0L9,33.5l-1.8,0l-1.3-7.6l-1.8,0L3.8,31l-1.8,0l-1-7.8l-1,0l-0.8-8l-1,0l-0.6-8.2l-0.8,0l-0.5-8.4l-0.6,0l-0.3-8.6l-0.5,0l0-8.8l-0.3,0l0.2-9l-0.2,0l0.3-9.2l-0.1,0l0.5-9.4l0,0l0.6-9.6l0.1,0l0.8-9.8l0.2,0l1-10l0.3,0l1.2-10.2l0.4,0l1.3-10.4l0.5,0l1.5-10.6l0.6,0l1.6-10.8l0.8,0l1.8-11l0.9,0l1.9-11.2l1,0l2.1-11.4l1.2,0l2.2-11.6l1.3,0l2.4-11.8l1.5,0l2.6-12l1.6,0l2.7-12.2l1.8,0l2.9-12.4l1.9,0l3.1-12.6l2.1,0l3.2-12.8l2.2,0l3.4-13l2.4,0l3.6-13.2l2.6,0l3.7-13.4l2.7,0l3.9-13.6l2.9,0l4.1-13.8l3.1,0l4.2-14l3.2,0l4.4-14.2l3.4,0l4.6-14.4l3.6,0l4.7-14.6l3.8,0l4.9-14.8l3.9,0l5.1-15l4.1,0l5.3-15.2l4.2,0l5.4-15.4l4.4,0l5.6-15.6l4.6,0l5.8-15.8l4.8,0l5.9-16l4.9,0l6.1-16.2l5.1,0l6.3-16.4l5.3,0l6.4-16.6l5.4,0l6.6-16.8l5.6,0l6.8-17l5.8,0l6.9-17.2l5.9,0l7.1-17.4l6.1,0l7.3-17.6l6.3,0l7.4-17.8l6.4,0l7.6-18l6.6,0l7.8-18.2l6.8,0l7.9-18.4l6.9,0l8.1-18.6l7.1,0l8.3-18.8l7.3,0l8.4-19l7.4,0l8.6-19.2l7.6,0l8.8-19.4l7.8,0l8.9-19.6l7.9,0l9.1-19.8l8.1,0l9.3-20l8.3,0l9.4-20.2l8.4,0l9.6-20.4l8.6,0l9.8-20.6l8.8,0l9.9-20.8l8.9,0l10.1-21l9.1,0l10.3-21.2l9.3,0l10.4-21.4l9.4,0l10.6-21.6l9.6,0l10.8-21.8l9.8,0l10.9-22l9.9,0l11.1-22.2l10.1,0l11.3-22.4l10.3,0l11.4-22.6l10.4,0l11.6-22.8l10.6,0l11.8-23l10.8,0l11.9-23.2l10.9,0l12.1-23.4l11.1,0l12.3-23.6l11.3,0l12.4-23.8l11.4,0l12.6-24l11.6,0l12.8-24.2l11.8,0l12.9-24.4l11.9,0l13.1-24.6l12.1,0l13.3-24.8l12.3,0l13.4-25l12.4,0l13.6-25.2l12.6,0l13.8-25.4l12.8,0l13.9-25.6l12.9,0l14.1-25.8l13.1,0l14.3-26l13.3,0l14.4-26.2l13.4,0l14.6-26.4l13.6,0l14.8-26.6l13.8,0l14.9-26.8l13.9,0l15.1-27l14.1,0l15.3-27.2l14.3,0l15.4-27.4l14.4,0l15.6-27.6l14.6,0l15.8-27.8l14.8,0l15.9-28l14.9,0l16.1-28.2l15.1,0l16.3-28.4l15.3,0l16.4-28.6l15.4,0l16.6-28.8l15.6,0l16.8-29l15.8,0l16.9-29.2l15.9,0l17.1-29.4l16.1,0l17.3-29.6l16.3,0l17.4-29.8l16.4,0l17.6-30l16.6,0l17.8-30.2l16.8,0l17.9-30.4l16.9,0l18.1-30.6l17.1,0l18.3-30.8l17.3,0l18.4-31l17.4,0l18.6-31.2l17.6,0l18.8-31.4l17.8,0l18.9-31.6l17.9,0l19.1-31.8l18.1,0l19.3-32l18.3,0l19.4-32.2l18.4,0l19.6-32.4l18.6,0l19.8-32.6l18.8,0l19.9-32.8l18.9,0l20.1-33l19.1,0l20.3-33.2l19.3,0l20.4-33.4l19.4,0l20.6-33.6l19.6,0l20.8-33.8l19.8,0l20.9-34l19.9,0l21.1-34.2l20.1,0l21.3-34.4l20.3,0l21.4-34.6l20.4,0l21.6-34.8l20.6,0l21.8-35l20.8,0l21.9-35.2l20.9,0l22.1-35.4l21.1,0l22.3-35.6l21.3,0l22.4-35.8l21.4,0l22.6-36l21.6,0l22.8-36.2l21.8,0l22.9-36.4l21.9,0l23.1-36.6l22.1,0l23.3-36.8l22.3,0l23.4-37l22.4,0l23.6-37.2l22.6,0l23.8-37.4l22.8,0l23.9-37.6l22.9,0l24.1-37.8l23.1,0l24.3-38l23.3,0l24.4-38.2l23.4,0l24.6-38.4l23.6,0l24.8-38.6l23.8,0l24.9-38.8l23.9,0l25.1-39l24.1,0l25.3-39.2l24.3,0l25.4-39.4l24.4,0l25.6-39.6l24.6,0l25.8-39.8l24.8,0l25.9-40l24.9,0l26.1-40.2l25.1,0l26.3-40.4l25.3,0l26.4-40.6l25.4,0l26.6-40.8l25.6,0l26.8-41l25.8,0l26.9-41.2l25.9,0l27.1-41.4l26.1,0l27.3-41.6l26.3,0l27.4-41.8l26.4,0l27.6-42l26.6,0l27.8-42.2l26.8,0l27.9-42.4l26.9,0l28.1-42.6l27.1,0l28.3-42.8l27.3,0l28.4-43l27.4,0l28.6-43.2l27.6,0l28.8-43.4l27.8,0l28.9-43.6l27.9,0l29.1-43.8l28.1,0l29.3-44l28.3,0l29.4-44.2l28.4,0l29.6-44.4l28.6,0l29.8-44.6l28.8,0l29.9-44.8l28.9,0l30.1-45l29.1,0l30.3-45.2l29.3,0l30.4-45.4l29.4,0l30.6-45.6l29.6,0l30.8-45.8l29.8,0l30.9-46l29.9,0l31.1-46.2l30.1,0l31.3-46.4l30.3,0l31.4-46.6l30.4,0l31.6-46.8l30.6,0l31.8-47l30.8,0l31.9-47.2l30.9,0l32.1-47.4l31.1,0l32.3-47.6l31.3,0l32.4-47.8l31.4,0l32.6-48l31.6,0l32.8-48.2l31.8,0l32.9-48.4l31.9,0l33.1-48.6l32.1,0l33.3-48.8l32.3,0l33.4-49l32.4,0l33.6-49.2l32.6,0l33.8-49.4l32.8,0l33.9-49.6l32.9,0l34.1-49.8l33.1,0l34.3-50l33.3,0l34.4-50.2l33.4,0l34.6-50.4l33.6,0l34.8-50.6l33.8,0l34.9-50.8l33.9,0l35.1-51l34.1,0l35.3-51.2l34.3,0l35.4-51.4l34.4,0l35.6-51.6l34.6,0l35.8-51.8l34.8,0l35.9-52l34.9,0l36.1-52.2l35.1,0l36.3-52.4l35.3,0l36.4-52.6l35.4,0l36.6-52.8l35.6,0l36.8-53l35.8,0l36.9-53.2l35.9,0l37.1-53.4l36.1,0l37.3-53.6l36.3,0l37.4-53.8l36.4,0l37.6-54l36.6,0l37.8-54.2l36.8,0l37.9-54.4l36.9,0l38.1-54.6l37.1,0l38.3-54.8l37.3,0l38.4-55l37.4,0l38.6-55.2l37.6,0l38.8-55.4l37.8,0l38.9-55.6l37.9,0l39.1-55.8l38.1,0l39.3-56l38.3,0l39.4-56.2l38.4,0l39.6-56.4l38.6,0l39.8-56.6l38.8,0l39.9-56.8l38.9,0l40.1-57l39.1,0l40.3-57.2l39.3,0l40.4-57.4l39.4,0l40.6-57.6l39.6,0l40.8-57.8l39.8,0l40.9-58l39.9,0l41.1-58.2l40.1,0l41.3-58.4l40.3,0l41.4-58.6l40.4,0l41.6-58.8l40.6,0l41.8-59l40.8,0l41.9-59.2l40.9,0l42.1-59.4l41.1,0l42.3-59.6l41.3,0l42.4-59.8l41.4,0l42.6-60l41.6,0l42.8-60.2l41.8,0l42.9-60.4l41.9,0l43.1-60.6l42.1,0l43.3-60.8l42.3,0l43.4-61l42.4,0l43.6-61.2l42.6,0l43.8-61.4l42.8,0l43.9-61.6l42.9,0l44.1-61.8l43.1,0l44.3-62l43.3,0l44.4-62.2l43.4,0l44.6-62.4l43.6,0l44.8-62.6l43.8,0l44.9-62.8l43.9,0l45.1-63l44.1,0l45.3-63.2l44.3,0l45.4-63.4l44.4,0l45.6-63.6l44.6,0l45.8-63.8l44.8,0l45.9-64l44.9,0l46.1-64.2l45.1,0l46.3-64.4l45.3,0l46.4-64.6l45.4,0l46.6-64.8l45.6,0l46.8-65l45.8,0l46.9-65.2l45.9,0l47.1-65.4l46.1,0l47.3-65.6l46.3,0l47.4-65.8l46.4,0l47.6-66l46.6,0l47.8-66.2l46.8,0l47.9-66.4l46.9,0l48.1-66.6l47.1,0l48.3-66.8l47.3,0l48.4-67l47.4,0l48.6-67.2l47.6,0l48.8-67.4l47.8,0l48.9-67.6l47.9,0l49.1-67.8l48.1,0l49.3-68l48.3,0l49.4-68.2l48.4,0l49.6-68.4l48.6,0l49.8-68.6l48.8,0l49.9-68.8l48.9,0l50.1-69l49.1,0l50.3-69.2l49.3,0l50.4-69.4l49.4,0l50.6-69.6l49.6,0l50.8-69.8l49.8,0l50.9-70l49.9,0l51.1-70.2l50.1,0l51.3-70.4l50.3,0l51.4-70.6l50.4,0l51.6-70.8l50.6,0l51.8-71l50.8,0l51.9-71.2l50.9,0l52.1-71.4l51.1,0l52.3-71.6l51.3,0l52.4-71.8l51.4,0l52.6-72l51.6,0l52.8-72.2l51.8,0l52.9-72.4l51.9,0l53.1-72.6l52.1,0l53.3-72.8l52.3,0l53.4-73l52.4,0l53.6-73.2l52.6,0l53.8-73.4l52.8,0l53.9-73.6l52.9,0l54.1-73.8l53.1,0l54.3-74l53.3,0l54.4-74.2l53.4,0l54.6-74.4l53.6,0l54.8-74.6l53.8,0l54.9-74.8l53.9,0l55.1-75l54.1,0l55.3-75.2l54.3,0l55.4-75.4l54.4,0l55.6-75.6l54.6,0l55.8-75.8l54.8,0l55.9-76l54.9,0l56.1-76.2l55.1,0l56.3-76.4l55.3,0l56.4-76.6l55.4,0l56.6-76.8l55.6,0l56.8-77l55.8,0l56.9-77.2l55.9,0l57.1-77.4l56.1,0l57.3-77.6l56.3,0l57.4-77.8l56.4,0l57.6-78l56.6,0l57.8-78.2l56.8,0l57.9-78.4l56.9,0l58.1-78.6l57.1,0l58.3-78.8l57.3,0l58.4-79l57.4,0l58.6-79.2l57.6,0l58.8-79.4l57.8,0l58.9-79.6l57.9,0l59.1-79.8l58.1,0l59.3-80l58.3,0l59.4-80.2l58.4,0l59.6-80.4l58.6,0l59.8-80.6l58.8,0l59.9-80.8l58.9,0l60.1-81l59.1,0l60.3-81.2l59.3,0l60.4-81.4l59.4,0l60.6-81.6l59.6,0l60.8-81.8l59.8,0l60.9-82l59.9,0l61.1-82.2l60.1,0l61.3-82.4l60.3,0l61.4-82.6l60.4,0l61.6-82.8l60.6,0l61.8-83l60.8,0l61.9-83.2l60.9,0l62.1-83.4l61.1,0l62.3-83.6l61.3,0l62.4-83.8l61.4,0l62.6-84l61.6,0l62.8-84.2l61.8,0l62.9-84.4l61.9,0l63.1-84.6l62.1,0l63.3-84.8l62.3,0l63.4-85l62.4,0l63.6-85.2l62.6,0l63.8-85.4l62.8,0l63.9-85.6l62.9,0l64.1-85.8l63.1,0l64.3-86l63.3,0l64.4-86.2l63.4,0l64.6-86.4l63.6,0l64.8-86.6l63.8,0l64.9-86.8l63.9,0l65.1-87l64.1,0l65.3-87.2l64.3,0l65.4-87.4l64.4,0l65.6-87.6l64.6,0l65.8-87.8l64.8,0l65.9-88l64.9,0l66.1-88.2l65.1,0l66.3-88.4l65.3,0l66.4-88.6l65.4,0l66.6-88.8l65.6,0l66.8-89l65.8,0l66.9-89.2l65.9,0l67.1-89.4l66.1,0l67.3-89.6l66.3,0l67.4-89.8l66.4,0l67.6-90l66.6,0l67.8-90.2l66.8,0l67.9-90.4l66.9,0l68.1-90.6l67.1,0l68.3-90.8l67.3,0l68.4-91l67.4,0l68.6-91.2l67.6,0l68.8-91.4l67.8,0l68.9-91.6l67.9,0l69.1-91.8l68.1,0l69.3-92l68.3,0l69.4-92.2l68.4,0l69.6-92.4l68.6,0l69.8-92.6l68.8,0l69.9-92.8l68.9,0l70.1-93l69.1,0l70.3-93.2l69.3,0l70.4-93.4l69.4,0l70.6-93.6l69.6,0l70.8-93.8l69.8,0l70.9-94l69.9,0l71.1-94.2l70.1,0l71.3-94.4l70.3,0l71.4-94.6l70.4,0l71.6-94.8l70.6,0l71.8-95l70.8,0l71.9-95.2l70.9,0l72.1-95.4l71.1,0l72.3-95.6l71.3,0l72.4-95.8l71.4,0l72.6-96l71.6,0l72.8-96.2l71.8,0l72.9-96.4l71.9,0l73.1-96.6l72.1,0l73.3-96.8l72.3,0l73.4-97l72.4,0l73.6-97.2l72.6,0l73.8-97.4l72.8,0l73.9-97.6l72.9,0l74.1-97.8l73.1,0l74.3-98l73.3,0l74.4-98.2l73.4,0l74.6-98.4l73.6,0l74.8-98.6l73.8,0l74.9-98.8l73.9,0l75.1-99l74.1,0l75.3-99.2l74.3,0l75.4-99.4l74.4,0l75.6-99.6l74.6,0l75.8-99.8l74.8,0l75.9-100l74.9,0l76.1,0l75.1,0l76.3,0l75.3,0l76.4,0l75.4,0l76.6,0l75.6,0l76.8,0l75.8,0l76.9,0l75.9,0l77.1,0l76.1,0l77.3,0l76.3,0l77.4,0l76.4,0l77.6,0l76.6,0l77.8,0l76.8,0l77.9,0l76.9,0l78.1,0l77.1,0l78.3,0l77.3,0l78.4,0l77.4,0l78.6,0l77.6,0l78.8,0l77.8,0l78.9,0l77.9,0l79.1,0l78.1,0l79.3,0l78.3,0l79.4,0l78.4,0l79.6,0l78.6,0l79.8,0l78.8,0l79.9,0l78.9,0l80.1,0l79.1,0l80.3,0l79.3,0l80.4,0l79.4,0l80.6,0l79.6,0l80.8,0l79.8,0l80.9,0l79.9,0l81.1,0l80.1,0l81.3,0l80.3,0l81.4,0l80.4,0l81.6,0l80.6,0l81.8,0l80.8,0l81.9,0l80.9,0l82.1,0l81.1,0l82.3,0l81.3,0l82.4,0l81.4,0l82.6,0l81.6,0l82.8,0l81.8,0l82.9,0l81.9,0l83.1,0l82.1,0l83.3,0l82.3,0l83.4,0l82.4,0l83.6,0l82.6,0l83.8,0l82.8,0l83.9,0l82.9,0l84.1,0l83.1,0l84.3,0l83.3,0l84.4,0l83.4,0l84.6,0l83.6,0l84.8,0l83.8,0l84.9,0l83.9,0l85.1,0l84.1,0l85.3,0l84.3,0l85.4,0l84.4,0l85.6,0l84.6,0l85.8,0l84.8,0l85.9,0l84.9,0l86.1,0l85.1,0l86.3,0l85.3,0l86.4,0l85.4,0l86.6,0l85.6,0l86.8,0l85.8,0l86.9,0l85.9,0l87.1,0l86.1,0l87.3,0l86.3,0l87.4,0l86.4,0l87.6,0l86.6,0l87.8,0l86.8,0l87.9,0l86.9,0l88.1,0l87.1,0l88.3,0l87.3,0l88.4,0l87.4,0l88.6,0l87.6,0l88.8,0l87.8,0l88.9,0l87.9,0l89.1,0l88.1,0l89.3,0l88.3,0l89.4,0l88.4,0l89.6,0l88.6,0l89.8,0l88.8,0l89.9,0l88.9,0l90.1,0l89.1,0l90.3,0l89.3,0l90.4,0l89.4,0l90.6,0l89.6,0l90.8,0l89.8,0l90.9,0l89.9,0l91.1,0l90.1,0l91.3,0l90.3,0l91.4,0l90.4,0l91.6,0l90.6,0l91.8,0l90.8,0l91.9,0l90.9,0l92.1,0l91.1,0l92.3,0l91.3,0l92.4,0l91.4,0l92.6,0l91.6,0l92.8,0l91.8,0l92.9,0l91.9,0l93.1,0l92.1,0l93.3,0l92.3,0l93.4,0l92.4,0l93.6,0l92.6,0l93.8,0l92.8,0l93.9,0l92.9,0l94.1,0l93.1,0l94.3,0l93.3,0l94.4,0l93.4,0l94.6,0l93.6,0l94.8,0l93.8,0l94.9,0l93.9,0l95.1,0l94.1,0l95.3,0l94.3,0l95.4,0l94.4,0l95.6,0l94.6,0l95.8,0l94.8,0l95.9,0l94.9,0l96.1,0l95.1,0l96.3,0l95.3,0l96.4,0l95.4,0l96.6,0l95.6,0l96.8,0l95.8,0l96.9,0l95.9,0l97.1,0l96.1,0l97.3,0l96.3,0l97.4,0l96.4,0l97.6,0l96.6,0l97.8,0l96.8,0l97.9,0l96.9,0l98.1,0l97.1,0l98.3,0l97.3,0l98.4,0l97.4,0l98.6,0l97.6,0l98.8,0l97.8,0l98.9,0l97.9,0l99.1,0l98.1,0l99.3,0l98.3,0l99.4,0l98.4,0l99.6,0l98.6,0l99.8,0l98.8,0l99.9,0l98.9,0l100.1,0l99.1,0l100.3,0l99.3,0l100.4,0l99.4,0l100.6,0l99.6,0l100.8,0l99.8,0l100.9,0l99.9,0l101.1,0l100.1,0l101.3,0l100.3,0l101.4,0l100.4,0l101.6,0l100.6,0l101.8,0l100.8,0l101.9,0l100.9,0l102.1,0l101.1,0l102.3,0l101.3,0l102.4,0l101.4,0l102.6,0l101.6,0l102.8,0l101.8,0l102.9,0l101.9,0l103.1,0l102.1,0l103.3,0l102.3,0l103.4,0l102.4,0l103.6,0l102.6,0l103.8,0l102.8,0l103.9,0l102.9,0l104.1,0l103.1,0l104.3,0l103.3,0l104.4,0l103.4,0l104.6,0l103.6,0l104.8,0l103.8,0l104.9,0l103.9,0l105.1,0l104.1,0l105.3,0l104.3,0l105.4,0l104.4,0l105.6,0l104.6,0l105.8,0l104.8,0l105.9,0l104.9,0l106.1,0l105.1,0l106.3,0l105.3,0l106.4,0l105.4,0l106.6,0l105.6,0l106.8,0l105.8,0l106.9,0l105.9,0l107.1,0l106.1,0l107.3,0l106.3,0l107.4,0l106.4,0l107.6,0l106.6,0l107.8,0l106.8,0l107.9,0l106.9,0l108.1,0l107.1,0l108.3,0l107.3,0l108.4,0l107.4,0l108.6,0l107.6,0l108.8,0l107.8,0l108.9,0l107.9,0l109.1,0l108.1,0l109.3,0l108.3,0l109.4,0l108.4,0l109.6,0l108.6,0l109.8,0l108.8,0l109.9,0l108.9,0l110.1,0l109.1,0l110.3,0l109.3,0l110.4,0l109.4,0l110.6,0l109.6,0l110.8,0l109.8,0l110.9,0l109.9,0l111.1,0l110.1,0l111.3,0l110.3,0l111.4,0l110.4,0l111.6,0l110.6,0l111.8,0l110.8,0l111.9,0l110.9,0l112.1,0l111.1,0l112.3,0l111.3,0l112.4,0l111.4,0l112.6,0l111.6,0l112.8,0l111.8,0l112.9,0l111.9,0l113.1,0l112.1,0l113.3,0l112.3,0l113.4,0l112.4,0l113.6,0l112.6,0l113.8,0l112.8,0l113.9,0l112.9,0l114.1,0l113.1,0l114.3,0l113.3,0l114.4,0l113.4,0l114.6,0l113.6,0l114.8,0l113.8,0l114.9,0l113.9,0l115.1,0l114.1,0l115.3,0l114.3,0l115.4,0l114.4,0l115.6,0l114.6,0l115.8,0l114.8,0l115.9,0l114.9,0l116.1,0l115.1,0l116.3,0l115.3,0l116.4,0l115.4,0l116.6,0l115.6,0l116.8,0l115.8,0l116.9,0l115.9,0l117.1,0l116.1,0l117.3,0l116.3,0l117.4,0l116.4,0l117.6,0l116.6,0l117.8,0l116.8,0l117.9,0l116.9,0l118.1,0l117.1,0l118.3,0l117.3,0l118.4,0l117.4,0l118.6,0l117.6,0l118.8,0l117.8,0l118.9,0l117.9,0l119.1,0l118.1,0l119.3,0l118.3,0l119.4,0l118.4,0l119.6,0l118.6,0l119.8,0l118.8,0l119.9,0l118.9,0l120.1,0l119.1,0l120.3,0l119.3,0l120.4,0l119.4,0l120.6,0l119.6,0l120.8,0l119.8,0l120.9,0l119.9,0l121.1,0l120.1,0l121.3,0l120.3,0l121.4,0l120.4,0l121.6,0l120.6,0l121.8,0l120.8,0l121.9,0l120.9,0l122.1,0l121.1,0l122.3,0l121.3,0l122.4,0l121.4,0l122.6,0l121.6,0l122.8,0l121.8,0l122.9,0l121.9,0l123.1,0l122.1,0l123.3,0l122.3,0l123.4,0l122.4,0l123.6,0l122.6,0l123.8,0l122.8,0l123.9,0l122.9,0l124.1,0l123.1,0l124.3,0l123.3,0l124.4,0l123.4,0l124.6,0l123.6,0l124.8,0l123.8,0l124.9,0l123.9,0l125.1,0l124.1,0l125.3,0l124.3,0l125.4,0l124.4,0l125.6,0l124.6,0l125.8,0l124.8,0l125.9,0l124.9,0l126.1,0l125.1,0l126.3,0l125.3,0l126.4,0l125.4,0l126.6,0l125.6,0l126.8,0l125.8,0l126.9,0l125.9,0l127.1,0l126.1,0l127.3,0l126.3,0l127.4,0l126.4,0l127.6,0l126.6,0l127.8,0l126.8,0l127.9,0l126.9,0l128.1,0l127.1,0l128.3,0l127.3,0l128.4,0l127.4,0l128.6,0l127.6,0l128.8,0l127.8,0l128.9,0l127.9,0l129.1,0l128.1,0l129.3,0l128.3,0l129.4,0l128.4,0l129.6,0l128.6,0l129.8,0l128.8,0l129.9,0l128.9,0l130.1,0l129.1,0l130.3,0l129.3,0l130.4,0l129.4,0l130.6,0l129.6,0l130.8,0l129.8,0l130.9,0l129.9,0l131.1,0l130.1,0l131.3,0l130.3,0l131.4,0l130.4,0l131.6,0l130.6,0l131.8,0l130.8,0l131.9,0l130.9,0l132.1,0l131.1,0l132.3,0l131.3,0l132.4,0l131.4,0l132.6,0l131.6,0l132.8,0l131.8,0l132.9,0l131.9,0l133.1,0l132.1,0l133.3,0l132.3,0l133.4,0l132.4,0l133.6,0l132.6,0l133.8,0l132.8,0l133.9,0l132.9,0l134.1,0l133.1,0l134.3,0l133.3,0l134.4,0l133.4,0l134.6,0l133.6,0l134.8,0l133.8,0l134.9,0l133.9,0l135.1,0l134.1,0l135.3,0l134.3,0l135.4,0l134.4,0l135.6,0l134.6,0l135.8,0l134.8,0l135.9,0l134.9,0l136.1,0l135.1,0l136.3,0l135.3,0l136.4,0l135.4,0l136.6,0l135.6,0l136.8,0l135.8,0l136.9,0l135.9,0l137.1,0l136.1,0l137.3,0l136.3,0l137.4,0l136.4,0l137.6,0l136.6,0l137.8,0l136.8,0l137.9,0l136.9,0l138.1,0l137.1,0l138.3,0l137.3,0l138.4,0l137.4,0l138.6,0l137.6,0l138.8,0l137.8,0l138.9,0l137.9,0l139.1,0l138.1,0l139.3,0l138.3,0l139.4,0l138.4,0l139.6,0l138.6,0l139.8,0l138.8,0l139.9,0l138.9,0l140.1,0l139.1,0l140.3,0l139.3,0l140.4,0l139.4,0l140.6,0l139.6,0l140.8,0l139.8,0l140.9,0l139.9,0l141.1,0l140.1,0l141.3,0l140.3,0l141.4,0l140.4,0l141.6,0l140.6,0l141.8,0l140.8,0l141.9,0l140.9,0l142.1,0l141.1,0l142.3,0l141.3,0l142.4,0l141.4,0l142.6,0l141.6,0l142.8,0l141.8,0l142.9,0l141.9,0l143.1,0l142.1,0l143.3,0l142.3,0l143.4,0l142.4,0l143.6,0l142.6,0l143.8,0l142.8,0l143.9,0l142.9,0l144.1,0l143.1,0l144.3,0l143.3,0l144.4,0l143.4,0l144.6,0l143.6,0l144.8,0l143.8,0l144.9,0l143.9,0l145.1,0l144.1,0l145.3,0l144.3,0l145.4,0l144.4,0l145.6,0l144.6,0l145.8,0l144.8,0l145.9,0l144.9,0l146.1,0l145.1,0l146.3,0l145.3,0l146.4,0l145.4,0l146.6,0l145.6,0l146.8,0l145.8,0l146.9,0l145.9,0l147.1,0l146.1,0l147.3,0l146.3,0l147.4,0l146.4,0l147.6,0l146.6,0l147.8,0l146.8,0l147.9,0l146.9,0l148.1,0l147.1,0l148.3,0l147.3,0l148.4,0l147.4,0l148.6,0l147.6,0l148.8,0l147.8,0l148.9,0l147.9,0l149.1,0l148.1,0l149.3,0l148.3,0l149.4,0l148.4,0l149.6,0l148.6,0l149.8,0l148.8,0l149.9,0l148.9,0l150.1,0l149.1,0l150.3,0l149.3,0l150.4,0l149.4,0l150.6,0l149.6,0l150.8,0l149.8,0l150.9,0l149.9,0l151.1,0l150.1,0l151.3,0l150.3,0l151.4,0l150.4,0l151.6,0l150.6,0l151.8,0l150.8,0l151.9,0l150.9,0l152.1,0l151.1,0l152.3,0l151.3,0l152.4,0l151.4,0l152.6,0l151.6,0l152.8,0l151.8,0l152.9,0l151.9,0l153.1,0l152.1,0l153.3,0l152.3,0l153.4,0l152.4,0l153.6,0l152.6,0l153.8,0l152.8,0l153.9,0l152.9,0l154.1,0l153.1,0l154.3,0l153.3,0l154.4,0l153.4,0l154.6,0l153.6,0l154.8,0l153.8,0l154.9,0l153.9,0l155.1,0l154.1,0l155.3,0l154.3,0l155.4,0l154.4,0l155.6,0l154.6,0l155.8,0l154.8,0l155.9,0l154.9,0l156.1,0l155.1,0l156.3,0l155.3,0l156.4,0l155.4,0l156.6,0l155.6,0l156.8,0l155.8,0l156.9,0l155.9,0l157.1,0l156.1,0l157.3,0l156.3,0l157.4,0l156.4,0l157.6,0l156.6,0l157.8,0l156.8,0l157.9,0l156.9,0l158.1,0l157.1,0l158.3,0l157.3,0l158.4,0l157.4,0l158.6,0l157.6,0l158.8,0l157.8,0l158.9,0l157.9,0l159.1,0l158.1,0l159.3,0l158.3,0l159.4,0l158.4,0l159.6,0l158.6,0l159.8,0l158.8,0l159.9,0l158.9,0l160.1,0l159.1,0l160.3,0l159.3,0l160.4,0l159.4,0l160.6,0l159.6,0l160.8,0l159.8,0l160.9,0l159.9,0l161.1,0l160.1,0l161.3,0l160.3,0l161.4,0l160.4,0l161.6,0l160.6,0l161.8,0l160.8,0l161.9,0l160.9,0l162.1,0l161.1,0l162.3,0l161.3,0l162.4,0l161.4,0l162.6,0l161.6,0l162.8,0l161.8,0l162.9,0l161.9,0l163.1,0l162.1,0l163.3,0l162.3,0l163.4,0l162.4,0l163.6,0l162.6,0l163.8,0l162.8,0l163.9,0l162.9,0l164.1,0l163.1,0l164.3,0l163.3,0l164.4,0l163.4,0l164.6,0l163.6,0l164.8,0l163.8,0l164.9,0l163.9,0l165.1,0l164.1,0l165.3,0l164.3,0l165.4,0l164.4,0l165.6,0l164.6,0l165.8,0l164.8,0l165.9,0l164.9,0l166.1,0l165.1,0l166.3,0l165.3,0l166.4,0l165.4,0l166.6,0l165.6,0l166.8,0l165.8,0l166.9,0l165.9,0l167.1,0l166.1,0l167.3,0l166.3,0l167.4,0l166.4,0l167.6,0l166.6,0l167.8,0l166.8,0l167.9,0l166.9,0l168.1,0l167.1,0l168.3,0l167.3,0l168.4,0l167.4,0l168.6,0l167.6,0l168.8,0l167.8,0l168.9,0l167.9,0l169.1,0l168.1,0l169.3,0l168.3,0l169.4,0l168.4,0l169.6,0l168.6,0l169.8,0l168.8,0l169.9,0l168.9,0l170.1,0l169.1,0l170.3,0l169.3,0l170.4,0l169.4,0l170.6,0l169.6,0l170.8,0l169.8,0l170.9,0l169.9,0l171.1,0l170.1,0l171.3,0l170.3,0l171.4,0l170.4,0l171.6,0l170.6,0l171.8,0l170.8,0l171.9,0l170.9,0l172.1,0l171.1,0l172.3,0l171.3,0l172.4,0l171.4,0l172.6,0l171.6,0l172.8,0l171.8,0l172.9,0l171.9,0l173.1,0l172.1,0l173.3,0l172.3,0l173.4,0l172.4,0l173.6,0l172.6,0l173.8,0l172.8,0l173.9,0l172.9,0l174.1,0l173.1,0l174.3,0l173.3,0l174.4,0l173.4,0l174.6,0l173.6,0l174.8,0l173.8,0l174.9,0l173.9,0l175.1,0l174.1,0l175.3,0l174.3,0l175.4,0l174.4,0l175.6,0l174.6,0l175.8,0l174.8,0l175.9,0l174.9,0l176.1,0l175.1,0l176.3,0l175.3,0l176.4,0l175.4,0l176.6,0l175.6,0l176.8,0l175.8,0l176.9,0l175.9,0l177.1,0l176.1,0l177.3,0l176.3,0l177.4,0l176.4,0l177.6,0l176.6,0l177.8,0l176.8,0l177.9,0l176.9,0l178.1,0l177.1,0l178.3,0l177.3,0l178.4,0l177.4,0l178.6,0l177.6,0l178.8,0l177.8,0l178.9,0l177.9,0l179.1,0l178.1,0l179.3,0l178.3,0l179.4,0l178.4,0l179.6,0l178.6,0l179.8,0l178.8,0l179.9,0l178.9,0l180.1,0l179.1,0l180.3,0l179.3,0l180.4,0l179.4,0l180.6,0l179.6,0l180.8,0l179.8,0l180.9,0l179.9,0l181.1,0l180.1,0l181.3,0l180.3,0l181.4,0l180.4,0l181.6,0l180.6,0l181.8,0l180.8,0l181.9,0l180.9,0l182.1,0l181.1,0l182.3,0l181.3,0l182.4,0l181.4,0l182.6,0l181.6,0l182.8,0l181.8,0l182.9,0l181.9,0l183.1,0l182.1,0l183.3,0l182.3,0l183.4,0l182.4,0l183.6,0l182.6,0l183.8,0l182.8,0l183.9,0l182.9,0l184.1,0l183.1,0l184.3,0l183.3,0l184.4,0l183.4,0l184.6,0l183.6,0l184.8,0l183.8,0l184.9,0l183.9,0l185.1,0l184.1,0l185.3,0l184.3,0l185.4,0l184.4,0l185.6,0l184.6,0l185.8,0l184.8,0l185.9,0l184.9,0l186.1,0l185.1,0l186.3,0l185.3,0l186.4,0l185.4,0l186.6,0l185.6,0l186.8,0l185.8,0l186.9,0l185.9,0l187.1,0l186.1,0l187.3,0l186.3,0l187.4,0l186.4,0l187.6,0l186.6,0l187.8,0l186.8,0l187.9,0l186.9,0l188.1,0l187.1,0l188.3,0l187.3,0l188.4,0l187.4,0l188.6,0l187.6,0l188.8,0l187.8,0l188.9,0l187.9,0l189.1,0l188.1,0l189.3,0l188.3,0l189.4,0l188.4,0l189.6,0l188.6,0l189.8,0l188.8,0l189.9,0l188.9,0l190.1,0l189.1,0l190.3,0l189.3,0l190.4,0l189.4,0l190.6,0l189.6,0l190.8,0l189.8,0l190.9,0l189.9,0l191.1,0l190.1,0l191.3,0l190.3,0l191.4,0l190.4,0l191.6,0l190.6,0l191.8,0l190.8,0l191.9,0l190.9,0l192.1,0l191.1,0l192.3,0l191.3,0l192.4,0l191.4,0l192.6,0l191.6,0l192.8,0l191.8,0l192.9,0l191.9,0l193.1,0l192.1,0l193.3,0l192.3,0l193.4,0l192.4,0l193.6,0l192.6,0l193.8,0l192.8,0l193.9,0l192.9,0l194.1,0l193.1,0l194.3,0l193.3,0l194.4,0l193.4,0l194.6,0l193.6,0l194.8,0l193.8,0l194.9,0l193.9,0l195.1,0l194.1,0l195.3,0l194.3,0l195.4,0l194.4,0l195.6,0l194.6,0l195.8,0l194.8,0l195.9,0l194.9,0l196.1,0l195.1,0l196.3,0l195.3,0l196.4,0l195.4,0l196.6,0l195.6,0l196.8,0l195.8,0l196.9,0l195.9,0l197.1,0l196.1,0l197.3,0l196.3,0l197.4,0l196.4,0l197.6,0l196.6,0l197.8,0l196.8,0l197.9,0l196.9,0l198.1,0l197.1,0l198.3,0l197.3,0l198.4,0l197.4,0l198.6,0l197.6,0l198.8,0l197.8,0l198.9,0l197.9,0l199.1,0l198.1,0l199.3,0l198.3,0l199.4,0l198.4,0l199.6,0l198.6,0l199.8,0l198.8,0l199.9,0l198.9,0l200.1,0l199.1,0l200.3,0l199.3,0l200.4,0l199.4,0l200.6,0l199.6,0l200.8,0l199.8,0l200.9,0l199.9,0l201.1,0l200.1,0l201.3,0l200.3,0l201.4,0l200.4,0l201.6,0l200.6,0l201.8,0l200.8,0l201.9,0l200.9,0l202.1,0l201.1,0l202.3,0l201.3,0l202.4,0l201.4,0l202.6,0l201.6,0l202.8,0l201.8,0l202.9,0l201.9,0l203.1,0l202.1,0l203.3,0l202.3,0l203.4,0l202.4,0l203.6,0l202.6,0l203.8,0l202.8,0l203.9,0l202.9,0l204.1,0l203.1,0l204.3,0l203.3,0l204.4,0l203.4,0l204.6,0l203.6,0l204.8,0l203.8,0l204.9,0l203.9,0l205.1,0l204.1,0l205.3,0l204.3,0l205.4,0l204.4,0l205.6,0l204.6,0l205.8,0l204.8,0l205.9,0l204.9,0l206.1,0l205.1,0l206.3,0l205.3,0l206.4,0l205.4,0l206.6,0l205.6,0l206.8,0l205.8,0l206.9,0l205.9,0l207.1,0l206.1,0l207.3,0l206.3,0l207.4,0l206.4,0l207.6,0l206.6,0l207.8,0l206.8,0l207.9,0l206.9,0l208.1,0l207.1,0l208.3,0l207.3,0l208.4,0l207.4,0l208.6,0l207.6,0l208.8,0l207.8,0l208.9,0l207.9,0l209.1,0l208.1,0l209.3,0l208.3,0l209.4,0l208.4,0l209.6,0l208.6,0l209.8,0l208.8,0l209.9,0l208.9,0l210.1,0l209.1,0l210.3,0l209.3,0l210.4,0l209.4,0l210.6,0l209.6,0l210.8,0l209.8,0l210.9,0l209.9,0l211.1,0l210.1,0l211.3,0l210.3,0l211.4,0l210.4,0l211.6,0l210.6,0l211.8,0l210.8,0l211.9,0l210.9,0l212.1,0l211.1,0l212.3,0l211.3,0l212.4,0l211.4,0l212.6,0l211.6,0l212.8,0l211.8,0l212.9,0l211.9,0l213.1,0l212.1,0l213.3,0l212.3,0l213.4,0l212.4,0l213.6,0l212.6,0l213.8,0l212.8,0l213.9,0l212.9,0l214.1,0l213.1,0l214.3,0l213.3,0l214.4,0l213.4,0l214.6,0l213.6,0l214.8,0l213.8,0l214.9,0l213.9,0l215.1,0l214.1,0l215.3,0l214.3,0l215.4,0l214.4,0l215.6,0l214.6,0l215.8,0l214.8,0l215.9,0l214.9,0l216.1,0l215.1,0l216.3,0l215.3,0l216.4,0l215.4,0l216.6,0l215.6,0l216.8,0l215.8,0l216.9,0l215.9,0l217.1,0l216.1,0l217.3,0l216.3,0l217.4,0l216.4,0l217.6,0l216.6,0l217.8,0l216.8,0l217.9,0l216.9,0l218.1,0l217.1,0l218.3,0l217.3,0l218.4,0l217.4,0l218.6,0l217.6,0l218.8,0l217.8,0l218.9,0l217.9,0l219.1,0l218.1,0l219.3,0l218.3,0l219.4,0l218.4,0l219.6,0l218.6,0l219.8,0l218.8,0l219.9,0l218.9,0l220.1,0l219.1,0l220.3,0l219.3,0l220.4,0l219.4,0l220.6,0l219.6,0l220.8,0l219.8,0l220.9,0l219.9,0l221.1,0l220.1,0l221.3,0l220.3,0l221.4,0l220.4,0l221.6,0l220.6,0l221.8,0l220.8,0l221.9,0l220.9,0l222.1,0l221.1,0l222.3,0l221.3,0l222.4,0l221.4,0l222.6,0l221.6,0l222.8,0l221.8,0l222.9,0l221.9,0l223.1,0l222.1,0l223.3,0l222.3,0l223.4,0l222.4,0l223.6,0l222.6,0l223.8,0l222.8,0l223.9,0l222.9,0l224.1,0l223.1,0l224.3,0l223.3,0l224.4,0l223.4,0l224.6,0l223.6,0l224.8,0l223.8,0l224.9,0l223.9,0l225.1,0l224.1,0l225.3,0l224.3,0l225.4,0l224.4,0l225.6,0l224.6,0l225.8,0l224.8,0l225.9,0l224.9,0l226.1,0l225.1,0l226.3,0l225.3,0l226.4,0l225.4,0l226.6,0l225.6,0l226.8,0l225.8,0l226.9,0l225.9,0l227.1,0l226.1,0l227.3,0l226.3,0l227.4,0l226.4,0l227.6,0l226.6,0l227.8,0l226.8,0l227.9,0l226.9,0l228.1,0l227.1,0l228.3,0l227.3,0l228.4,0l227.4,0l228.6,0l227.6,0l228.8,0l227.8,0l228.9,0l227.9,0l229.1,0l228.1,0l229.3,0l228.3,0l229.4,0l228.4,0l229.6,0l228.6,0l229.8,0l228.8,0l229.9,0l228.9,0l230.1,0l229.1,0l230.3,0l229.3,0l230.4,0l229.4,0l230.6,0l229.6,0l230.8,0l229.8,0l230.9,0l229.9,0l231.1,0l230.1,0l231.3,0l230.3,0l231.4,0l230.4,0l231.6,0l230.6,0l231.8,0l230.8,0l231.9,0l230.9,0l232.1,0l231.1,0l232.3,0l231.3,0l232.4,0l231.4,0l232.6,0l231.6,0l232.8,0l231.8,0l232.9,0l231.9,0l233.1,0l232.1,0l233.3,0l232.3,0l233.4,0l232.4,0l233.6,0l232.6,0l233.8,0l232.8,0l233.9,0l232.9,0l234.1,0l233.1,0l234.3,0l233.3,0l234.4,0l233.4,0l234.6,0l233.6,0l234.8,0l233.8,0l234.9,0l233.9,0l235.1,0l234.1,0l235.3,0l234.3,0l235.4,0l234.4,0l235.6,0l234.6,0l235.8,0l234.8,0l235.9,0l234.9,0l236.1,0l235.1,0l236.3,0l235.3,0l236.4,0l235.4,0l236.6,0l235.6,0l236.8,0l235.8,0l236.9,0l235.9,0l237.1,0l236.1,0l237.3,0l236.3,0l237.4,0l236.4,0l237.6,0l236.6,0l237.8,0l236.8,0l237.9,0l236.9,0l238.1,0l237.1,0l238.3,0l237.3,0l238.4,0l237.4,0l238.6,0l237.6,0l238.8,0l237.8,0l238.9,0l237.9,0l239.1,0l238.1,0l239.3,0l238.3,0l239.4,0l238.4,0l239.6,0l238.6,0l239.8,0l238.8,0l239.9,0l238.9,0l240.1,0l239.1,0l240.3,0l239.3,0l240.4,0l239.4,0l240.6,0l239.6,0l240.8,0l239.8,0l240.9,0l239.9,0l241.1,0l240.1,0l241.3,0l240.3,0l241.4,0l240.4,0l241.6,0l240.6,0l241.8,0l240.8,0l241.9,0l240.9,0l242.1,0l241.1,0l242.3,0l241.3,0l242.4,0l241.4,0l242.6,0l241.6,0l242.8,0l241.8,0l242.9,0l241.9,0l243.1,0l242.1,0l243.3,0l242.3,0l243.4,0l242.4,0l243.6,0l242.6,0l243.8,0l242.8,0l243.9,0l242.9,0l244.1,0l243.1,0l244.3,0l243.3,0l244.4,0l243.4,0l244.6,0l243.6,0l244.8,0l243.8,0l244.9,0l243.9,0l245.1,0l244.1,0l245.3,0l244.3,0l245.4,0l244.4,0l245.6,0l244.6,0l245.8,0l244.8,0l245.9,0l244.9,0l246.1,0l245.1,0l246.3,0l245.3,0l246.4,0l245.4,0l246.6,0l245.6,0l246.8,0l245.8,0l246.9,0l245.9,0l247.1,0l246.1,0l247.3,0l246.3,0l247.4,0l246.4,0l247.6,0l246.6,0l247.8,0l246.8,0l247.9,0l246.9,0l248.1,0l247.1,0l248.3,0l247.3,0l248.4,0l247.4,0l248.6,0l247.6,0l248.8,0l247.8,0l248.9,0l247.9,0l249.1,0l248.1,0l249.3,0l248.3,0l249.4,0l248.4,0l249.6,0l248.6,0l249.8,0l248.8,0l249.9,0l248.9,0l250.1,0l249.1,0l250.3,0l249.3,0l250.4,0l249.4,0l250.6,0l249.6,0l250.8,0l249.8,0l250.9,0l249.9,0l251.1,0l250.1,0l251.3,0l250.3,0l251.4,0l250.4,0l251.6,0l250.6,0l251.8,0l250.8,0l251.9,0l250.9,0l252.1,0l251.1,0l252.3,0l251.3,0l252.4,0l251.4,0l252.6,0l251.6,0l252.8,0l251.8,0l252.9,0l251.9,0l253.1,0l252.1,0l253.3,0l252.3,0l253.4,0l252.4,0l253.6,0l252.6,0l253.8,0l252.8,0l253.9,0l252.9,0l254.1,0l253.1,0l254.3,0l253.3,0l254.4,0l253.4,0l254.6,0l253.6,0l254.8,0l253.8,0l254.9,0l253.9,0l255.1,0l254.1,0l255.3,0l254.3,0l255.4,0l254.4,0l255.6,0l254.6,0l255.8,0l254.8,0l255.9,0l254.9,0l256.1,0l255.1,0l256.3,0l255.3,0l256.4,0l255.4,0l256.6,0l255.6,0l256.8,0l255.8,0l256.9,0l255.9,0l257.1,0l256.1,0l257.3,0l256.3,0l257.4,0l256.4,0l257.6,0l256.6,0l257.8,0l256.8,0l257.9,0l256.9,0l258.1,0l257.1,0l258.3,0l257.3,0l258.4,0l257.4,0l258.6,0l257.6,0l258.8,0l257.8,0l258.9,0l257.9,0l259.1,0l258.1,0l259.3,0l258.3,0l259.4,0l258.4,0l259.6,0l258.6,0l259.8,0l258.8,0l259.9,0l258.9,0l260.1,0l259.1,0l260.3,0l259.3,0l260.4,0l259.4,0l260.6,0l259.6,0l260.8,0l259.8,0l260.9,0l259.9,0l261.1,0l260.1,0l261.3,0l260.3,0l261.4,0l260.4,0l261.6,0l260.6,0l261.8,0l260.8,0l261.9,0l260.9,0l262.1,0l261.1,0l262.3,0l261.3,0l262.4,0l261.4,0l262.6,0l261.6,0l262.8,0l261.8,0l262.9,0l261.9,0l263.1,0l262.1,0l263.3,0l262.3,0l263.4,0l262.4,0l263.6,0l262.6,0l263.8,0l262.8,0l263.9,0l262.9,0l264.1,0l263.1,0l264.3,0l263.3,0l264.4,0l263.4,0l264.6,0l263.6,0l264.8,0l263.8,0l264.9,0l263.9,0l265.1,0l264.1,0l265.3,0l264.3,0l265.4,0l264.4,0l265.6,0l264.6,0l265.8,0l264.8,0l265.9,0l264.9,0l266.1,0l265.1,0l266.3,0l265.3,0l266.4,0l265.4,0l266.6,0l265.6,0l266.8,0l265.8,0l266.9,0l265.9,0l267.1,0l266.1,0l267.3,0l266.3,0l267.4,0l266.4,0l267.6,0l266.6,0l267.8,0l266.8,0l267.9,0l266.9,0l268.1,0l267.1,0l268.3,0l267.3,0l268.4,0l267.4,0l268.6,0l267.6,0l268.8,0l267.8,0l268.9,0l267.9,0l269.1,0l268.1,0l269.3,0l268.3,0l269.4,0l268.4,0l269.6,0l268.6,0l269.8,0l268.8,0l269.9,0l268.9,0l270.1,0l269.1,0l270.3,0l269.3,0l270.4,0l269.4,0l270.6,0l269.6,0l270.8,0l269.8,0l270.9,0l269.9,0l271.1,0l270.1,0l271.3,0l270.3,0l271.4,0l270.4,0l271.6,0l270.6,0l271.8,0l270.8,0l271.9,0l270.9,0l272.1,0l271.1,0l272.3,0l271.3,0l272.4,0l271.4,0l272.6,0l271.6,0l272.8,0l271.8,0l272.9,0l271.9,0l273.1,0l272.1,0l273.3,0l272.3,0l273.4,0l272.4,0l273.6,0l272.6,0l273.8,0l272.8,0l273.9,0l272.9,0l274.1,0l273.1,0l274.3,0l273.3,0l274.4,0l273.4,0l274.6,0l273.6,0l274.8,0l273.8,0l274.9,0l273.9,0l275.1,0l274.1,0l275.3,0l274.3,0l275.4,0l274.4,0l275.6,0l274.6,0l275.8,0l274.8,0l275.9,0l274.9,0l276.1,0l275.1,0l276.3,0l275.3,0l276.4,0l275.4,0l276.6,0l275.6,0l276.8,0l275.8,0l276.9,0l275.9,0l277.1,0l276.1,0l277.3,0l276.3,0l277.4,0l276.4,0l277.6,0l276.6,0l277.8,0l276.8,0l277.9,0l276.9,0l278.1,0l277.1,0l278.3,0l277.3,0l278.4,0l277.4,0l278.6,0l277.6,0l278.8,0l277.8,0l278.9,0l277.9,0l279.1,0l278.1,0l279.3,0l278.3,0l279.4,0l278.4,0l279.6,0l278.6,0l279.8,0l278.8,0l279.9,0l278.9,0l280.1,0l279.1,0l280.3,0l279.3,0l280.4,0l279.4,0l280.6,0l279.6,0l280.8,0l279.8,0l280.9,0l279.9,0l281.1,0l280.1,0l281.3,0l280.3,0l281.4,0l280.4,0l281.6,0l280.6,0l281.8,0l280.8,0l281.9,0l280.9,0l282.1,0l281.1,0l282.3,0l281.3,0l282.4,0l281.4,0l282.6,0l281.6,0l282.8,0l281.8,0l282.9,0l281.9,0l283.1,0l282.1,0l283.3,0l282.3,0l283.4,0l282.4,0l283.6,0l282.6,0l283.8,0l282.8,0l283.9,0l282.9,0l284.1,0l283.1,0l284.3,0l283.3,0l284.4,0l283.4,0l284.6,0l283.6,0l284.8,0l283.8,0l284.9,0l283.9,0l285.1,0l284.1,0l285.3,0l284.3,0l285.4,0l284.4,0l285.6,0l284.6,0l285.8,0l284.8,0l285.9,0l284.9,0l286.1,0l285.1,0l286.3,0l285.3,0l286.4,0l285.4,0l286.6,0l285.6,0l286.8,0l285.8,0l286.9,0l285.9,0l287.1,0l286.1,0l287.3,0l286.3,0l287.4,0l286.4,0l287.6,0l286.6,0l287.8,0l286.8,0l287.9,0l286.9,0l288.1,0l287.1,0l288.3,0l287.3,0l288.4,0l287.4,0l288.6,0l287.6,0l288.8,0l287.8,0l288.9,0l287.9,0l289.1,0l288.1,0l289.3,0l288.3,0l289.4,0l288.4,0l289.6,0l288.6,0l289.8,0l288.8,0l289.9,0l288.9,0l290.1,0l289.1,0l290.3,0l289.3,0l290.4,0l289.4,0l290.6,0l289.6,0l290.8,0l289.8,0l290.9,0l289.9,0l291.1,0l290.1,0l291.3,0l290.3,0l291.4,0l290.4,0l291.6,0l290.6,0l291.8,0l290.8,0l291.9,0l290.9,0l292.1,0l291.1,0l292.3,0l291.3,0l292.4,0l291.4,0l292.6,0l291.6,0l292.8,0l291.8,0l292.9,0l291.9,0l293.1,0l292.1,0l293.3,0l292.3,0l293.4,0l292.4,0l293.6,0l292.6,0l293.8,0l292.8,0l293.9,0l292.9,0l294.1,0l293.1,0l294.3,0l293.3,0l294.4,0l293.4,0l294.6,0l293.6,0l294.8,0l293.8,0l294.9,0l293.9,0l295.1,0l294.1,0l295.3,0l294.3,0l295.4,0l294.4,0l295.6,0l294.6,0l295.8,0l294.8,0l295.9,0l294.9,0l296.1,0l295.1,0l296.3,0l295.3,0l296.4,0l295.4,0l296.6,0l295.6,0l296.8,0l295.8,0l296.9,0l295.9,0l297.1,0l296.1,0l297.3,0l296.3,0l297.4,0l296.4,0l297.6,0l296.6,0l297.8,0l296.8,0l297.9,0l296.9,0l298.1,0l297.1,0l298.3,0l297.3,0l298.4,0l297.4,0l298.6,0l297.6,0l298.8,0l297.8,0l298.9,0l297.9,0l299.1,0l298.1,0l299.3,0l298.3,0l299.4,0l298.4,0l299.6,0l298.6,0l299.8,0l298.8,0l299.9,0l298.9,0l300.1,0l299.1,0l300.3,0l299.3,0l300.4,0l299.4,0l300.6,0l299.6,0l300.8,0l299.8,0l300.9,0l299.9,0l301.1,0l300.1,0l301.3,0l300.3,0l301.4,0l300.4,0l301.6,0l300.6,0l301.8,0l300.8,0l301.9,0l300.9,0l302.1,0l301.1,0l302.3,0l301.3,0l302.4,0l301.4,0l302.6,0l301.6,0l302.8,0l301.8,0l302.9,0l301.9,0l303.1,0l302.1,0l303.3,0l302.3,0l303.4,0l302.4,0l303.6,0l302.6,0l303.8,0l302.8,0l303.9,0l302.9,0l304.1,0l303.1,0l304.3,0l303.3,0l304.4,0l303.4,0l304.6,0l303.6,0l304.8,0l303.8,0l304.9,0l303.9,0l305.1,0l304.1,0l305.3,0l304.3,0l305.4,0l304.4,0l305.6,0l304.6,0l305.8,0l304.8,0l305.9,0l304.9,0l306.1,0l305.1,0l306.3,0l305.3,0l306.4,0l305.4,0l306.6,0l305.6,0l306.8,0l305.8,0l306.9,0l305.9,0l307.1,0l306.1,0l307.3,0l306.3,0l307.4,0l306.4,0l307.6,0l306.6,0l307.8,0l306.8,0l307.9,0l306.9,0l308.1,0l307.1,0l308.3,0l307.3,0l308.4,0l307.4,0l308.6,0l307.6,0l308.8,0l307.8,0l308.9,0l307.9,0l309.1,0l308.1,0l309.3,0l308.3,0l309.4,0l308.4,0l309.6,0l308.6,0l309.8,0l308.8,0l309.9,0l308.9,0l310.1,0l309.1,0l310.3,0l309.3,0l310.4,0l309.4,0l310.6,0l309.6,0l310.8,0l309.8,0l310.9,0l309.9,0l311.1,0l310.1,0l311.3,0l310.3,0l311.4,0l310.4,0l311.6,0l310.6,0l311.8,0l310.8,0l311.9,0l310.9,0l312.1,0l311.1,0l312.3,0l311.3,0l312.4,0l311.4,0l312.6,0l311.6,0l312.8,0l311.8,0l312.9,0l311.9,0l313.1,0l312.1,0l313.3,0l312.3,0l313.4,0l312.4,0l313.6,0l312.6,0l313.8,0l312.8,0l313.9,0l312.9,0l314.1,0l313.1,0l314.3,0l313.3,0l314.4,0l313.4,0l314.6,0l313.6,0l314.8,0l313.8,0l314.9,0l313.9,0l315.1,0l314.1,0l315.3,0l314.3,0l315.4,0l314.4,0l315.6,0l314.6,0l315.8,0l314.8,0l315.9,0l314.9,0l316.1,0l315.1,0l316.3,0l315.3,0l316.4,0l315.4,0l316.6,0l315.6,0l316.8,0l315.8,0l316.9,0l315.9,0l317.1,0l316.1,0l317.3,0l316.3,0l317.4,0l316.4,0l317.6,0l316.6,0l317.8,0l316.8,0l317.9,0l316.9,0l318.1,0l317.1,0l318.3,0l317.3,0l318.4,0l317.4,0l318.6,0l317.6,0l318.8,0l317.8,0l318.9,0l317.9,0l319.1,0l318.1,0l319.3,0l318.3,0l319.4,0l318.4,0l319.6,0l318.6,0l319.8,0l318.8,0l319.9,0l318.9,0l320.1,0l319.1,0l320.3,0l319.3,0l320.4,0l319.4,0l320.6,0l319.6,0l320.8,0l319.8,0l320.9,0l319.9,0l321.1,0l320.1,0l321.3,0l320.3,0l321.4,0l320.4,0l321.6,0l320.6,0l321.8,0l320.8,0l321.9,0l320.9,0l322.1,0l321.1,0l322.3,0l321.3,0l322.4,0l321.4,0l322.6,0l321.6,0l322.8,0l321.8,0l322.9,0l321.9,0l323.1,0l322.1,0l323.3,0l322.3,0l323.4,0l322.4,0l323.6,0l322.6,0l323.8,0l322.8,0l323.9,0l322.9,0l324.1,0l323.1,0l324.3,0l323.3,0l324.4,0l323.4,0l324.6,0l323.6,0l324.8,0l323.8,0l324.9,0l323.9,0l325.1,0l324.1,0l325.3,0l324.3,0l325.4,0l324.4,0l325.6,0l324.6,0l325.8,0l324.8,0l325.9,0l324.9,0l326.1,0l325.1,0l326.3,0l325.3,0l326.4,0l325.4,0l326.6,0l325.6,0l326.8,0l325.8,0l326.9,0l325.9,0l327.1,0l326.1,0l327.3,0l326.3,0l327.4,0l326.4,0l327.6,0l326.6,0l327.8,0l326.8,0l327.9,0l326.9,0l328.1,0l327.1,0l328.3,0l327.3,0l328.4,0l327.4,0l328.6,0l327.6,0l328.8,0l327.8,0l328.9,0l327.9,0l329.1,0l328.1,0l329.3,0l328.3,0l329.4,0l328.4,0l329.6,0l328.6,0l329.8,0l328.8,0l329.9,0l328.9,0l330.1,0l329.1,0l330.3,0l329.3,0l330.4,0l329.4,0l330.6,0l329.6,0l330.8,0l329.8,0l330.9,0l329.9,0l331.1,0l330.1,0l331.3,0l330.3,0l331.4,0l330.4,0l331.6,0l330.6,0l331.8,0l330.8,0l331.9,0l330.9,0l332.1,0l331.1,0l332.3,0l331.3,0l332.4,0l331.4,0l332.6,0l331.6,0l332.8,0l331.8,0l332.9,0l331.9,0l333.1,0l332.1,0l333.3,0l332.3,0l333.4,0l332.4,0l333.6,0l332.6,0l333.8,0l332.8,0l333.9,0l332.9,0l334.1,0l333.1,0l334.3,0l333.3,0l334.4,0l333.4,0l334.6,0l333.6,0l334.8,0l333.8,0l334.9,0l333.9,0l335.1,0l334.1,0l335.3,0l334.3,0l335.4,0l334.4,0l335.6,0l334.6,0l335.8,0l334.8,0l335.9,0l334.9,0l336.1,0l335.1,0l336.3,0l335.3,0l336.4,0l335.4,0l336.6,0l335.6,0l336.8,0l335.8,0l336.9,0l335.9,0l337.1,0l336.1,0l337.3,0l336.3,0l337.4,0l336.4,0l337.6,0l336.6,0l337.8,0l336.8,0l337.9,0l336.9,0l338.1,0l337.1,0l338.3,0l337.3,0l338.4,0l337.4,0l338.6,0l337.6,0l338.8,0l337.8,0l338.9,0l337.9,0l339.1,0l338.1,0l339.3,0l338.3,0l339.4,0l338.4,0l339.6,0l338.6,0l339.8,0l338.8,0l339.9,0l338.9,0l340.1,0l339.1,0l340.3,0l339.3,0l340.4,0l339.4,0l340.6,0l339.6,0l340.8,0l339.8,0l340.9,0l339.9,0l341.1,0l340.1,0l341.3,0l340.3,0l341.4,0l340.4,0l341.6,0l340.6,0l341.8,0l340.8,0l341.9,0l340.9,0l342.1,0l341.1,0l342.3,0l341.3,0l342.4,0l341.4,0l342.6,0l341.6,0l342.8,0l341.8,0l342.9,0l341.9,0l343.1,0l342.1,0l343.3,0l342.3,0l343.4,0l342.4,0l343.6,0l342.6,0l343.8,0l342.8,0l343.9,0l342.9,0l344.1,0l343.1,0l344.3,0l343.3,0l344.4,0l343.4,0l344.6,0l343.6,0l344.8,0l343.8,0l344.9,0l343.9,0l345.1,0l344.1,0l345.3,0l344.3,0l345.4,0l344.4,0l345.6,0l344.6,0l345.8,0l344.8,0l345.9,0l344.9,0l346.1,0l345.1,0l346.3,0l345.3,0l346.4,0l345.4,0l346.6,0l345.6,0l346.8,0l345.8,0l346.9,0l345.9,0l347.1,0l346.1,0l347.3,0l346.3,0l347.4,0l346.4,0l347.6,0l346.6,0l347.8,0l346.8,0l347.9,0l346.9,0l348.1,0l347.1,0l348.3,0l347.3,0l348.4,0l347.4,0l348.6,0l347.6,0l348.8,0l347.8,0l348.9,0l347.9,0l349.1,0l348.1,0l349.3,0l348.3,0l349.4,0l348.4,0l349.6,0l348.6,0l349.8,0l348.8,0l349.9,0l348.9,0l350.1,0l349.1,0l350.3,0l349.3,0l350.4,0l349.4,0l350.6,0l349.6,0l350.8,0l349.8,0l350.9,0l349.9,0l351.1,0l350.1,0l351.3,0l350.3,0l351.4,0l350.4,0l351.6,0l350.6,0l351.8,0l350.8,0l351.9,0l350.9,0l352.1,0l351.1,0l352.3,0l351.3,0l352.4,0l351.4,0l352.6,0l351.6,0l352.8,0l351.8,0l352.9,0l351.9,0l353.1,0l352.1,0l353.3,0l352.3,0l353.4,0l352.4,0l353.6,0l352.6,0l353.8,0l352.8,0l353.9,0l352.9,0l354.1,0l353.1,0l354.3,0l353.3,0l354.4,0l353.4,0l354.6,0l353.6,0l354.8,0l353.8,0l354.9,0l353.9,0l355.1,0l354.1,0l355.3,0l354.3,0l355.4,0l354.4,0l355.6,0l354.6,0l355.8,0l354.8,0l355.9,0l354.9,0l356.1,0l355.1,0l356.3,0l355.3,0l356.4,0l355.4,0l356.6,0l355.6,0l356.8,0l355.8,0l356.9,0l355.9,0l357.1,0l356.1,0l357.3,0l356.3,0l357.4,0l356.4,0l357.6,0l356.6,0l357.8,0l356.8,0l357.9,0l356.9,0l358.1,0l357.1,0l358.3,0l357.3,0l358.4,0l357.4,0l358.6,0l357.6,0l358.8,0l357.8,0l358.9,0l357.9,0l359.1,0l358.1,0l359.3,0l358.3,0l359.4,0l358.4,0l359.6,0l358.6,0l359.8,0l358.8,0l359.9,0l358.9,0l360,0z";

const airportsByIata = new Map(airports.map(a => [a.iata, a]));

interface InteractiveFlightMapProps {
    selectedDate: string;
    onDateChange: (date: string) => void;
    statusFilter: 'All' | 'On Time' | 'Alert';
    onStatusFilterChange: (status: 'All' | 'On Time' | 'Alert') => void;
}


export const InteractiveFlightMap: React.FC<InteractiveFlightMapProps> = ({ 
    selectedDate, 
    onDateChange,
    statusFilter,
    onStatusFilterChange
}) => {
    const [selectedFlight, setSelectedFlight] = useState<FlightJourney | null>(null);

    const filteredFlights = useMemo(() => {
        return mockFlights.filter(f => {
            const dateMatch = f.date === selectedDate;
            const statusMatch = statusFilter === 'All' || f.status === statusFilter;
            return dateMatch && statusMatch;
        });
    }, [selectedDate, statusFilter]);

    const stats = useMemo(() => {
        let male = 0;
        let female = 0;
        let other = 0;
        let alertCount = 0;
        let totalPassengers = 0;

        const flightsForStats = statusFilter === 'All' 
            ? mockFlights.filter(f => f.date === selectedDate) 
            : filteredFlights;

        flightsForStats.forEach(flight => {
            if (flight.status === 'Alert') {
                alertCount++;
            }
            flight.passengers.forEach(p => {
                totalPassengers++;
                if (p.gender === 'Male') male++;
                if (p.gender === 'Female') female++;
                if (p.gender === 'Other') other++;
            });
        });
        
        const totalAlertsOnDate = mockFlights
            .filter(f => f.date === selectedDate && f.status === 'Alert')
            .length;

        return { male, female, other, alertCount: totalAlertsOnDate, totalPassengers };
    }, [selectedDate, filteredFlights, statusFilter]);

    const selectedFlightDetails = useMemo(() => {
        if (!selectedFlight) return null;

        const origin = airportsByIata.get(selectedFlight.origin);
        const dest = airportsByIata.get(selectedFlight.destination);

        if (!origin || !dest) return null;

        const controlX = (origin.coords.x + dest.coords.x) / 2 + (dest.coords.y - origin.coords.y) * 0.2;
        const controlY = (origin.coords.y + dest.coords.y) / 2 - (dest.coords.x - origin.coords.x) * 0.2;

        const midX = 0.25 * origin.coords.x + 0.5 * controlX + 0.25 * dest.coords.x;
        const midY = 0.25 * origin.coords.y + 0.5 * controlY + 0.25 * dest.coords.y;

        return {
            flight: selectedFlight,
            position: { x: midX, y: midY }
        };
    }, [selectedFlight]);

    return (
        <div 
            className="relative w-full h-full bg-[#172554] rounded-lg overflow-hidden"
            onClick={() => setSelectedFlight(null)}
        >
             {/* Map SVG */}
            <svg viewBox="0 0 100 85" className="absolute inset-0 w-full h-full">
                 <defs>
                    <symbol id="airplane-icon" viewBox="0 0 10 10">
                        <path d="M 5 0 L 10 10 L 5 8 L 0 10 Z" />
                    </symbol>
                </defs>
                {/* World Map Background */}
                <path d={worldMapPath} fill="#1e3a8a" stroke="#3b82f6" strokeWidth="0.1" />

                {/* Flight Paths */}
                {filteredFlights.map(flight => {
                    const origin = airportsByIata.get(flight.origin);
                    const dest = airportsByIata.get(flight.destination);
                    if (!origin || !dest) return null;

                    const isAlert = flight.status === 'Alert';
                    const controlX = (origin.coords.x + dest.coords.x) / 2 + (dest.coords.y - origin.coords.y) * 0.2;
                    const controlY = (origin.coords.y + dest.coords.y) / 2 - (dest.coords.x - origin.coords.x) * 0.2;
                    const pathId = `path-${flight.id}`;
                    const pathData = `M${origin.coords.x},${origin.coords.y} Q${controlX},${controlY} ${dest.coords.x},${dest.coords.y}`;

                    // Calculate midpoint for alert indicator
                    const midX = 0.25 * origin.coords.x + 0.5 * controlX + 0.25 * dest.coords.x;
                    const midY = 0.25 * origin.coords.y + 0.5 * controlY + 0.25 * dest.coords.y;

                    return (
                        <g 
                            key={flight.id}
                            className="cursor-pointer group"
                            onClick={(e) => {
                                e.stopPropagation();
                                setSelectedFlight(flight);
                            }}
                        >
                            {/* Visual path with hover effect */}
                            <path
                                id={pathId}
                                d={pathData}
                                stroke={isAlert ? 'rgba(239, 68, 68, 0.6)' : 'rgba(255,255,255,0.2)'}
                                strokeWidth={isAlert ? "0.5" : "0.3"}
                                strokeDasharray="2 2"
                                fill="none"
                                className="transition-all duration-200 group-hover:stroke-width-[0.6] group-hover:stroke-white/60"
                            />
                            {/* Clickable area */}
                            <path
                                d={pathData}
                                stroke="transparent"
                                strokeWidth="3"
                                fill="none"
                            />
                             <use href="#airplane-icon" width="2" height="2" fill={isAlert ? '#f87171' : 'white'} opacity="0.9">
                                <animateMotion dur="8s" repeatCount="indefinite" rotate="auto" fill="freeze">
                                    <mpath href={`#${pathId}`} />
                                </animateMotion>
                            </use>
                             {isAlert && flight.alertCount > 0 && (
                                <g className="pointer-events-none">
                                    <circle cx={midX} cy={midY} r="1.2" fill="#ef4444" stroke="white" strokeWidth="0.1" />
                                    <text
                                        x={midX}
                                        y={midY}
                                        fill="white"
                                        fontSize="1.2"
                                        textAnchor="middle"
                                        dominantBaseline="middle"
                                        fontWeight="bold"
                                        className="font-sans"
                                    >
                                        {flight.alertCount}
                                    </text>
                                </g>
                            )}
                        </g>
                    );
                })}

                {/* Airports */}
                {airports.map(airport => (
                    <g key={airport.iata} className="cursor-pointer group">
                        <circle cx={airport.coords.x} cy={airport.coords.y} r="0.8" fill={airport.iata === 'CGK' ? '#f59e0b' : 'white'} opacity="0.7"/>
                        <circle cx={airport.coords.x} cy={airport.coords.y} r="1.5" fill="transparent" stroke={airport.iata === 'CGK' ? '#f59e0b' : 'white'} strokeWidth="0.2" opacity="0">
                           <animate attributeName="opacity" values="0;1;0" dur="2s" repeatCount="indefinite" />
                           <animate attributeName="r" values="0.5;2" dur="2s" repeatCount="indefinite" />
                        </circle>
                        <text x={airport.coords.x + 1.2} y={airport.coords.y + 0.4} fontSize="2" fill="white" className="opacity-0 group-hover:opacity-100 transition-opacity font-sans pointer-events-none">
                            {airport.iata}
                        </text>
                    </g>
                ))}
            </svg>

            {/* Controls and Stats Overlay */}
            <div className="absolute top-0 left-0 p-4 w-full flex justify-between items-start text-white pointer-events-none">
                 <div className="bg-black/30 p-3 rounded-lg backdrop-blur-sm pointer-events-auto">
                    <h3 className="text-xl font-bold text-white drop-shadow-lg mb-2">Global Flight Operations Overview</h3>
                    <div className="flex gap-4">
                        <div>
                            <label htmlFor="flight-date" className="block text-sm font-medium">Flight Date</label>
                            <input
                                type="date"
                                id="flight-date"
                                value={selectedDate}
                                onChange={e => onDateChange(e.target.value)}
                                className="mt-1 bg-white/10 border-white/20 rounded-md p-2 text-sm focus:ring-brand-accent focus:border-brand-accent"
                            />
                        </div>
                        <div>
                            <label htmlFor="status-filter" className="block text-sm font-medium">Flight Status</label>
                            <select 
                                id="status-filter" 
                                value={statusFilter}
                                onChange={(e) => onStatusFilterChange(e.target.value as 'All' | 'On Time' | 'Alert')}
                                className="mt-1 bg-white/10 border-white/20 rounded-md p-2 text-sm focus:ring-brand-accent focus:border-brand-accent w-full"
                            >
                                <option value="All">All Flights</option>
                                <option value="On Time">On Time</option>
                                <option value="Alert">Alert</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div className="bg-black/30 p-3 rounded-lg text-right backdrop-blur-sm pointer-events-auto max-w-xs">
                    <h4 className="font-bold text-lg">Live Statistics ({selectedDate})</h4>
                    <p className="text-sm">Total Passengers: <span className="font-bold">{stats.totalPassengers}</span></p>
                    <p className="text-xs text-gray-300">
                        (M: {stats.male}, F: {stats.female}, O: {stats.other})
                    </p>
                     <p className="text-sm mt-2">Active Alerts on this date: <span className="font-bold text-red-400">{stats.alertCount}</span></p>
                </div>
            </div>

            {/* Flight Detail Tooltip */}
            {selectedFlightDetails && (
                <div
                    style={{
                        position: 'absolute',
                        left: `${selectedFlightDetails.position.x}%`,
                        top: `${selectedFlightDetails.position.y}%`,
                        transform: 'translate(-50%, -120%)',
                        pointerEvents: 'auto',
                    }}
                    className="z-10 bg-white/90 text-brand-dark rounded-lg p-3 shadow-2xl backdrop-blur-md text-sm w-56 animate-scale-in"
                    onClick={e => e.stopPropagation()} // Prevent map click from closing it when interacting with the tooltip
                >
                    <div className="flex justify-between items-center border-b border-gray-300 pb-2 mb-2">
                        <h4 className="font-bold text-base">{selectedFlightDetails.flight.flightNumber}</h4>
                        <button 
                            onClick={() => setSelectedFlight(null)} 
                            className="text-gray-500 hover:text-gray-800"
                            aria-label="Close flight details"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>
                        </button>
                    </div>
                    <div className="space-y-1">
                        <p><strong>Route:</strong> {selectedFlightDetails.flight.origin} &rarr; {selectedFlightDetails.flight.destination}</p>
                        {selectedFlightDetails.flight.status === 'Alert' ? (
                            <p className="flex items-center">
                                <strong>Status:</strong> 
                                <span className="ml-2 font-semibold text-red-600">Alert ({selectedFlightDetails.flight.alertCount})</span>
                            </p>
                        ) : (
                            <p><strong>Status:</strong> <span className="font-semibold text-green-600">On Time</span></p>
                        )}
                    </div>
                </div>
            )}
        </div>
    );
};